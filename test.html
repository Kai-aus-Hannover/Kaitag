<!DOCTYPE html>
<html>
    <head>
        <title>Kai aus Hannover Linksammlung</title>
        <meta charset="utf-8">
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/kaitag.css">
        <script src="js/jquery-3.2.1.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script type="text/javascript">
            var $ = jQuery;
            var download = null;
            var ausgabe = [];
            var zeit = 0;
            function anzeigen(inhalt) {
                if (inhalt && inhalt.data && typeof inhalt.data.tree === "object") {
                    download = inhalt.data.tree;
                } else {
                    $("head").append('<meta http-equiv="refresh" content="10">');
                    console.log(inhalt.data.message);
                }
            }
            function eingabe(A) {
                for (var i = download.length - 1; i >= 0; --i) {
                    if (download[i].path.substring(0, 6) == "Links/" && download[i].type == "blob") {
                        var Z = 0;
                        var datum = download[i].path.split(".");
                        if (typeof datum[Z+2] === "undefined") {
                            console.log(download[i].path);
                        } else {
                            var jahr = Number(datum[Z+2].slice(0, 4));
                            var monat = Number(datum[Z+1]);
                            var tag = Number(datum[Z].slice(-2));
                            var anzahl = 0;
                            switch(A) {
                                case 1:
                                    ausgabe[jahr] = [];
                                    break;
                                case 2:
                                    ausgabe[jahr][monat] = [];
                                    break;
                                case 3:
                                    ausgabe[jahr][monat][tag] = [];
                                    break;
                                case 4:
                                    while(ausgabe[jahr][monat][tag][anzahl]) {
                                        console.log("hallo", anzahl);
                                        anzahl++;
                                    }
                                    ausgabe[jahr][monat][tag][anzahl] = download[i].path;
                                    break;
                            } 
                        }
                    }
                }
            }
            function aufbauen() {                     
                eingabe(1);
                eingabe(2);
                eingabe(3);
                for (var jahr = ausgabe.length - 1; jahr >= 0; --jahr) {
                    var JAHR = ausgabe[jahr];
                    if (typeof JAHR === "object") {
                        for (var monat = JAHR.length - 1; monat >= 0; --monat) {
                            var MONAT = JAHR[monat];
                            if (typeof MONAT === "object") {
                                for (var tag = MONAT.length - 1; tag >= 0; --tag) {
                                     var TAG = MONAT[tag];
                                    if (typeof TAG === "object") {
                                        for (var anzahl = TAG.length - 1; anzahl >= 0; --anzahl) {
                                            var ANZAHL = TAG[monat];
                                            if (typeof ANZAHL === "string") {
                                                var pfad = ANZAHL;
                                                if (pfad.substring(0, 6) == "Links/") {
                                                    var name = pfad.split('.').reverse().slice(1).reverse().join('.').split("/").slice(1).join("");
                                                    var i = jahr+"-"+monat+"-"+tag;
                                                    var typ = name.indexOf("Kaitag am Freitag") >= 0 ? "kaitag-am-freitag" : name.indexOf("Kaitag Aktuell") >= 0 ? "kaitag-aktuell" : name.indexOf("Nachgedacht Nachgefragt") >= 0 ? "nachgedacht-nachgefragt" : "";
                                                    $("body").append('<a class="link versteckt collapsed '+typ+'" id="link-' + i + '"data-toggle="collapse" href="#' + i + '" aria-expanded="false" aria-controls="footwear">' + name + '</a><div class="inhalt collapse" id="' + i + '"><div class="fehler404">Noch beim Laden</div></div>');
                                                        (function(i, pfad) {
                                                        zeit += 50;
                                                        setTimeout(function() {
                                                            $("#" + i).load(encodeURIComponent(pfad), function(inhalt, ergebnis) {
                                                                if (ergebnis == "success") {
                                                                    $("#link-" + i).after('<div class="videos"></div>');
                                                                    var platformen = {};
                                                                    platformen["dtube"] = "DTube";
                                                                    platformen["youtube"] = "YouTube";
                                                                    platformen["dailymotion"] = "dailymotion";
                                                                    platformen["bitchute"] = "BITCHUTE";
                                                                    platformen["bittube"] = "BitTube";
                                                                    console.log("hier");
                                                                    Object.keys(platformen).forEach(function(a) {
                                                                        console.log("plaftorm", platformen[a], a);
                                                                        var video_link = $("#"+i+" ." + a).length ? '<a class="' + a + '" href="' + $("#"+i+" ." + a).attr("href") + '">'+platformen[a]+'</a>' : "";
                                                                        $("#"+i+" ." + a).remove();
                                                                        console.log(video_link);
                                                                        $("#link-" + i + " + .videos").append(video_link);
                                                                    });
                                                                    $("#link-" + i).removeClass("versteckt");
                                                                    $("#kein_js2").remove();
                                                                    if ($("#"+i).html().length < 10)
                                                                        $("#"+i).html('<div class="keine_links">keine weiteren Links vorhanden</div>');
                                                                    $("#link-"+i).css("padding-right", $("#link-"+i).next().width());
                                                                } else {
                                                                    $("#"+i).html('<div class="fehler404">Fehler '+ergebnis+'</div>');
                                                                    console.log(ergebnis);
                                                                }
                                                            });
                                                        }, zeit);
                                                    })(i, pfad);
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }                             
            }
            function checken() {
                download !== null ? aufbauen() : setTimeout(checken, 50);
            }
            var timer = setTimeout(function() {
                $("head").append('<meta http-equiv="refresh" content="1">');
            }, 30);
            $(document).ready(function(){
                clearTimeout(timer);
                checken();
                $("#kein_js1").remove();
                download == null ? null : $("#kein_js2").remove();
                $(".bild_sofort_laden").remove();
            });
        </script>
        <script src="https://api.github.com/repos/Kai-aus-Hannover/Kaitag/git/trees/master?recursive=1&callback=anzeigen"></script>
    </head>
    <body>
        <h1 data-toggle="collapse" aria-expanded="true" data-target=".collapse">Kai aus Hannover Linksammlung</h1>
        <div class="bild_sofort_laden">
            <img src="logo/dtube.svg">
            <img src="logo/dtube-hover.svg">
        </div>
        <div class="fehler" id="kein_js1">Fehler Javascript ist nicht aktiviert.</div>
        <div class="fehler" id="kein_js2">Fehler 404 keine Antwort von api.github.com</div>
    </body>
</html>