<!DOCTYPE html>
<html>

<head>
    <title>Kai aus Hannover Linksammlung</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=1200">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/kaitag.css">
    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript">
        var $ = jQuery;
        var download = null;
        var ausgabe = [];
        var liste = [];
        var max = 20;
        var wartezeit = 10;
        var gesperrt_timer = 0;
        function sperrung() {
            clearTimeout(gesperrt_timer);
            gesperrt_timer = setTimeout(gesperrt, 200);
        }
        for (var i = 200; i < 5000; i = i + 200) {
            setTimeout(gesperrt, i);
        }
        function gesperrt() {
            var blockiert = [
                [".youtube", "#link-2019-5-12-0"],
                [".dailymotion", "#link-2019-6-4-0"],
                [".direkt", "#link-2019-2-22-0"]
            ];
            for(var i = 0, len = blockiert.length; i < len; i++) {
                var element = $(blockiert[i][1]);
                while (element.length) {
                    if (element.hasClass("link_container")) {
                        var platform = $(blockiert[i][0], element);
                        if (!platform.hasClass("gesperrt")) {
                            platform.addClass("gesperrt");
                        }
                    }
                    element = element.next()
                }
            }
        }
        function anzeigen(inhalt) {
            if (inhalt && inhalt.data && typeof inhalt.data.tree === "object") {
                download = inhalt.data.tree;
            } else {
                $("head").append('<meta http-equiv="refresh" content="10">');
                console.log(inhalt.data.message);
            }
        }
        function link_anpassen(this_) {
            while ($(this_).height() < $("span", this_).height()) {
                var F = parseFloat($("span", this_).css("font-size")) - 0.1;
                if (F < 14) {
                    $(this_).css({ "whites-space": "nowrap", "line-height": "15px" });
                    break;
                }
                $("span", this_).css("font-size", F + "px");
            }
        }
        function link_resize() {
            $(".link").each(function () {
                $(this).css({ "line-height": "unset" });
                $("span", this).css({ "font-size": "", "white_space": "unset" });
                link_anpassen(this);
            });
        }
        $(window).resize(link_resize);
        function eingabe(A) {
            for (var i = download.length - 1; i >= 0; --i) {
                if (download[i].path.substring(0, 6) == "Links/" && download[i].type == "blob") {
                    var Z = 0;
                    var datum = download[i].path.split(".");
                    if (typeof datum[Z + 2] === "undefined") {
                        console.log(download[i].path);
                    } else {
                        var jahr = Number(datum[Z + 2].slice(0, 4));
                        var monat = Number(datum[Z + 1]);
                        var tag = Number(datum[Z].slice(-2));
                        switch (A) {
                            case 1:
                                ausgabe[jahr] = [];
                                break;
                            case 2:
                                ausgabe[jahr][monat] = [];
                                break;
                            case 3:
                                ausgabe[jahr][monat][tag] = [];
                                break;
                            case 4:
                                for (var anzahl = 0; ausgabe[jahr][monat][tag][anzahl]; anzahl++); // ohne {}
                                ausgabe[jahr][monat][tag][anzahl] = download[i].path;
                                break;
                        }
                    }
                }
            }
        }
        function abrufen() {
            for (var j = -1; j < liste.length && typeof video == "undefined"; j++) {
                var video = liste.pop();
            }
            if (typeof video == "undefined") {
                return false;
            }
            var i = video[0];
            var pfad = video[1];
            $("#" + i).load(pfad, function (inhalt, ergebnis) {
                if (ergebnis == "success") {
                    var platformen = {};
                    platformen["bittube"] = "BitTube";
                    platformen["dtube"] = "DTube";
                    platformen["bitchute"] = "BITCHUTE";
                    platformen["dailymotion"] = "dailymotion";
                    platformen["youtube"] = "YouTube";
                    Object.keys(platformen).forEach(function (a) {
                        var video_link = $("#" + i + " ." + a).length ? '<a class="video_links ' + a + '" href="' + $("#" + i + " ." + a).attr("href") + '">' + platformen[a] + '</a>' : "";
                        $("#link-" + i).append(video_link);
                        $("#" + i + " ." + a).remove();
                    });
                    $("#link-" + i).append('<a class="video_links direkt" href="http://video.kai-aus-hannover.de/?v=' + encodeURIComponent($("#link-" + i + " span").text() + '.mp4') + '">Direkt</a>');
                    $("#link-" + i).removeClass("versteckt");
                    $("#kein_js2").remove();
                    link_anpassen($("#" + i + " .link"));
                    if ($("#" + i).html().length < 10) {
                        $("#" + i).html('<div class="keine_links">keine weiteren Links vorhanden</div>');
                    }
                } else {
                    $("#" + i).html('<div class="fehler404">Fehler ' + ergebnis + '</div>');
                    console.log("#" + i, ergebnis);
                    liste.unshift([i, pfad]);
                    wartezeit *= 1.05;
                }
                sperrung();
                setTimeout(abrufen, wartezeit);
            });
        }
        function aufbauen() {
            eingabe(1); // jahr
            eingabe(2); // monat
            eingabe(3); // tag
            eingabe(4); // zwei am Tag
            for (var jahr = ausgabe.length - 1; jahr >= 0; --jahr) {
                if (typeof ausgabe[jahr] === "object") {
                    for (var monat = ausgabe[jahr].length - 1; monat >= 0; --monat) {
                        if (typeof ausgabe[jahr][monat] === "object") {
                            for (var tag = ausgabe[jahr][monat].length - 1; tag >= 0; --tag) {
                                if (typeof ausgabe[jahr][monat][tag] === "object") {
                                    for (var anzahl = ausgabe[jahr][monat][tag].length - 1; anzahl >= 0; --anzahl) {
                                        if (typeof ausgabe[jahr][monat][tag][anzahl] === "string") {
                                            var pfad = ausgabe[jahr][monat][tag][anzahl];
                                            if (pfad.substring(0, 6) == "Links/") {
                                                var name = pfad.split('.').reverse().slice(1).reverse().join('.').split("/").slice(1).join("");
                                                var i = [jahr, monat, tag, anzahl].join("-");
                                                var typ = name.indexOf("Kaitag am Freitag") >= 0 ? "kaitag-am-freitag" : name.indexOf("Kaitag Aktuell") >= 0 ? "kaitag-aktuell" : name.indexOf("Nachgedacht Nachgefragt") >= 0 ? "nachgedacht-nachgefragt" : "";
                                                $("body").append('<div class="link_container versteckt" id="link-' + i + '"><a class="link collapsed ' + typ + '" data-toggle="collapse" href="#' + i + '" aria-expanded="false" aria-controls="footwear"><span>' + name + '</span></a></div><div class="inhalt collapse" id="' + i + '"><div class="fehler404">Noch beim Laden</div></div>');
                                                liste[liste.length + 1] = [i, encodeURIComponent(pfad)];
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            liste = liste.reverse();
            for (var i = 0; i < max; i++) {
                abrufen();
            }
            link_resize();
            setTimeout(link_resize, 1000);
            setTimeout(link_resize, 5000);
            setTimeout(link_resize, 10000);
        }
        function checken() {
            download !== null ? aufbauen() : setTimeout(checken, 50);
        }
        var timer = setTimeout(function () {
            $("head").append('<meta http-equiv="refresh" content="1">');
        }, 30000);
        $(document).ready(function () {
            clearTimeout(timer);
            checken();
            $("#kein_js1").remove();
            download == null ? null : $("#kein_js2").remove();
            $(".bild_sofort_laden").remove();
        });
    </script>
    <script
        src="https://api.github.com/repos/Kai-aus-Hannover/Kaitag/git/trees/master?recursive=1&callback=anzeigen"></script>
</head>

<body>
    <h1 data-toggle="collapse" aria-expanded="true" data-target=".collapse">Kai aus Hannover Linksammlung</h1>
    <div class="bild_sofort_laden" style="overflow:hidden;margin:0;padding:0;width:0;height:0;">
        <img src="logo/dtube.svg">
        <img src="logo/dtube-hover.svg">
        <img src="logo/bitchute.png">
        <img src="logo/bittube.jpg">
        <img src="logo/bittube-hover.jpg">
        <img src="logo/telegram.svg">
    </div>
    <div class="link_container" id="link-kaitag-verteiler">
        <a class="link collapsed halb" style="line-height: unset;" href="https://unabhÃ¤ngigkeitserklÃ¤rung.eu/">
            <span>Newsletter 'Kaitag Verteiler'</span>
        </a>
        <a class="link collapsed halb telegram" style="line-height: unset;" href="https://t.me/kaiorak">
            <span>Telegram Kanal</span>
        </a>
    </div>
    <div class="fehler" id="kein_js1">Fehler Javascript ist nicht aktiviert.</div>
    <div class="fehler" id="kein_js2">Fehler 404 keine Antwort von api.github.com</div>
</body>

</html>
