<!DOCTYPE html>
<html>
    <head>
        <title>Kai aus Hannover Linksammlung</title>
        <meta charset="utf-8">
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/style.css">
        <script src="js/jquery-3.2.1.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script type="text/javascript">
            $ = jQuery;
            download = null;
            ausgabe = [];
            function anzeigen(inhalt) {
                console.log(typeof inhalt.data.tree);
                if (inhalt && inhalt.data && typeof inhalt.data.tree === "object") {
                    download = inhalt.data.tree;
                } else {
                    $("head").append('<meta http-equiv="refresh" content="60">');
                }
            }
            function eingabe(A) {
                for (var i = download.length - 1; i >= 0; --i) {
                    if (download[i].path.substring(0, 6) == "Links/" && download[i].type == "blob") {
                        var Z = 0;
                        var datum = download[i].path.split(".");
                        var jahr = Number(datum[Z+2].slice(0, 4));
                        var monat = Number(datum[Z+1]);
                        var tag = Number(datum[Z].slice(-2));
                        switch(A) {
                            case 1:
                                ausgabe[jahr] = [];
                                break;
                            case 2:
                                ausgabe[jahr][monat] = [];
                                break;
                            case 3:
                                ausgabe[jahr][monat][tag] = download[i].path;
                                break;
                        } 
                    }
                }
            }
            function aufbauen() {                     
                eingabe(1);
                eingabe(2);
                eingabe(3);
                for (var jahr = ausgabe.length - 1; jahr >= 0; --jahr) {
                    if (typeof ausgabe[jahr] === "object") {
                        for (var monat = ausgabe[jahr].length - 1; monat >= 0; --monat) {
                            if (typeof ausgabe[jahr][monat] === "object") {
                                for (var tag = ausgabe[jahr][monat].length - 1; tag >= 0; --tag) {
                                    if (typeof ausgabe[jahr][monat][tag] === "string") {
                                        var pfad = ausgabe[jahr][monat][tag];
                                        if (pfad.substring(0, 6) == "Links/") {
                                            var name = pfad.split('.').reverse().slice(1).reverse().join('.').split("/").slice(1);
                                            var i = jahr+"-"+monat+"-"+tag;
                                            var typ = name.indexOf("Kaitag am Freitag") ? "kaitag-am-freitag" : name.indexOf("Kaitag Aktuell") ? "kaitag-aktuell" : "";
                                            $("body").append('<a class="link versteckt collapsed '+typ+'" id="link-' + i + '"data-toggle="collapse" href="#' + i + '" aria-expanded="false" aria-controls="footwear">' + name + '</a><div class="inhalt collapse" id="' + i + '"><div class="fehler404">Noch beim Laden oder Fehler 404</div></div>');
                                            (function(i, pfad) {
                                                $("#" + i).load(encodeURIComponent(pfad), function(inhalt, ergebnis) {
                                                    if (ergebnis == "success") {
                                                        var dtube = $("#"+i+" .dtube").length ? '<a target="_blank" class="dtube" href="' + $("#"+i+" .dtube").attr("href") + '">DTube</a>' : "";
                                                        var youtube = $("#"+i+" .youtube").length ? '<a target="_blank" class="youtube" href="' + $("#"+i+" .youtube").attr("href") + '">YouTube</a>' : "";
                                                        var dailymotion = $("#"+i+" .dailymotion").length ? '<a target="_blank" class="dailymotion" href="' + $("#"+i+" .dailymotion").attr("href") + '">dailymotion</a>' : "";
                                                        $("#link-" + i).removeClass("versteckt");
                                                        $('<div class="videos">'+dtube+youtube+dailymotion+'</div>').insertAfter("#link-" + i);
                                                        $("#kein_js2").remove();
                                                        $("#"+i+" .dtube").remove();
                                                        $("#"+i+" .youtube").remove();
                                                        $("#"+i+" .dailymotion").remove();
                                                        if ($("#"+i).html().length < 10)
                                                            $("#"+i).html('<div class="keine_links">nur Verlinkungen zum Video vorhanden</div>');
                                                    }
                                                });
                                            })(i, pfad);
                                        }
                                    }
                                }
                            }
                        }
                    }
                }                             
            }
            function checken() {
                download !== null ? aufbauen() : setTimeout(checken, 50);
            }
            $(document).ready(function(){
                checken();
                $("#kein_js1").remove();
                download == null ? null : $("#kein_js2").remove();
                $(".bild_sofort_laden").remove();
            });
        </script>
        <script src="https://api.github.com/repos/Kai-aus-Hannover/Kaitag/git/trees/master?recursive=1&callback=anzeigen"></script>
    </head>
    <body>
        <h1 type="button" data-toggle="collapse" aria-expanded="true" data-target=".collapse">Kai aus Hannover Linksammlung</h1>
        <div class="fehler" id="kein_js1">Fehler Javascript ist nicht aktiviert.</div>
        <div class="fehler" id="kein_js2">Fehler 404 keine Antwort von api.github.com</div>
        <div class="bild_sofort_laden">
            <img src="logo/dtube.svg">
            <img src="logo/dtube-hover.svg">
        </div>
        <a class="link collapsed" id="link-erklärung" data-toggle="collapse" href="#erklärung" aria-expanded="false" aria-controls="footwear">Eidesstattliche Versicherung</a><div class="inhalt collapse" id="erklärung"><img src="bilder/EV.png"></div>
    </body>
</html>
